
SISO vector decoder for IRA-LDPC codes in VHDL

### Quick start

Prerequisites:

* [GHDL](https://github.com/ghdl/ghdl) to simulate VHDL.
* [GNU Make](https://www.gnu.org/software/make/) to use the [Makefile](Makefile) for building.
* [GTKWave](http://gtkwave.sourceforge.net/) to view the waveforms generated by the simulation.
* C++ compiler to build the test vector generators.

Run ```make``` to build and simulate vector version. Compare resulting ```dec_vector_tb_out.txt``` with ```dec_vector_tb_exp.txt```.

Scalar versions for studying:

Run ```make scalar``` to build and simulate scalar version. Compare resulting ```cnp_scalar_tb_out.txt``` with ```cnp_scalar_tb_exp.txt```.

Run ```make vcd``` to generate scalar version waveforms and watch them via ```gtkwave cnp_scalar_tb.vcd```.

### TODO

* Tool for generating code table entries
* Tool for enforcing below rules for code table entries
* Interface for switching or replacing code table
* Shortening the pipeline if timing analysis allows it
* Self-Corrected Min-Sum
* More corner case testing and documentation
* Can the interface be improved?

### DONE

* Min-Sum or Offset-Min-Sum with fixed beta = 1
* Pipelined processing
* Write disable flags to resolve write conflicts with DDSMs
* Reference decoder in C++
* Tool for checking code table entries for data hazards

### [ldpc_scalar.vhd](ldpc_scalar.vhd)

scalar LDPC decoder configuration

### [ldpc_scalar.hh](ldpc_scalar.hh)

scalar LDPC decoder configuration

### [ldpc_vector.vhd](ldpc_vector.vhd)

vector LDPC decoder configuration

### [ldpc_vector.hh](ldpc_vector.hh)

vector LDPC decoder configuration

### [table_vector.txt](table_vector.txt)

Transformed and manipulated DVB T2 B7 code table for vector length of 15:

* Rows are sorted by location offsets to keep same offsets consecutive.
* Above sorting helps maximally spacing out same offsets on consecutive columns.
* Manually swapped columns to avoid same offsets on consecutive columns.

### [check_table_vector_txt.hh](check_table_vector_txt.hh)

check table_vector.txt for data hazards

The following rules must apply to the table for the decoder to work correctly:

* Rows containing DDSMs must keep locations with same offset consecutive.
* Order of location offsets must avoid data hazards caused by the pipeline.
* Optional: Keep same count rows consecutive to avoid pipeline stalls.

### [table_vector.vhd](table_vector.vhd)

code table generated from [table_vector.txt](table_vector.txt) by [generate_table_vector_vhd.cc](generate_table_vector_vhd.cc)

### [cnp_scalar_tb.vhd](cnp_scalar_tb.vhd)

testbench for the scalar check node processor

### [cnp_vector_tb.vhd](cnp_vector_tb.vhd)

testbench for the vector check node processor

### [dec_vector_tb.vhd](dec_vector_tb.vhd)

testbench for the decoder

### [dec_vector.vhd](dec_vector.vhd)

SISO vector decoder for IRA-LDPC codes

### [cnp_scalar.vhd](cnp_scalar.vhd)

scalar check node processor

### [cnp_vector.vhd](cnp_vector.vhd)

vector check node processor

### [buf_scalar.vhd](buf_scalar.vhd)

buffer for the scalar check node processor

### [generate_cnp_scalar_tb_inp_txt.cc](generate_cnp_scalar_tb_inp_txt.cc)

generate [cnp_scalar_tb_inp.txt](cnp_scalar_tb_inp.txt) from random noise

### [generate_cnp_scalar_tb_exp_txt.cc](generate_cnp_scalar_tb_exp_txt.cc)

generate [cnp_scalar_tb_exp.txt](cnp_scalar_tb_exp.txt) processed from [cnp_scalar_tb_inp.txt](cnp_scalar_tb_inp.txt)

### [buf_vector.vhd](buf_vector.vhd)

buffer for the vector check node processor

### [generate_cnp_vector_tb_inp_txt.cc](generate_cnp_vector_tb_inp_txt.cc)

generate [cnp_vector_tb_inp.txt](cnp_vector_tb_inp.txt) from random noise

### [generate_cnp_vector_tb_exp_txt.cc](generate_cnp_vector_tb_exp_txt.cc)

generate [cnp_vector_tb_exp.txt](cnp_vector_tb_exp.txt) processed from [cnp_vector_tb_inp.txt](cnp_vector_tb_inp.txt)

### [generate_dec_vector_tb_inp_txt.cc](generate_dec_vector_tb_inp_txt.cc)

Generate [dec_vector_tb_inp.txt](dec_vector_tb_inp.txt) from random noise

### [generate_dec_vector_tb_exp_txt.cc](generate_dec_vector_tb_exp_txt.cc)

Generate [dec_vector_tb_exp.txt](dec_vector_tb_exp.txt) decoded from [dec_vector_tb_inp.txt](dec_vector_tb_inp.txt)

### [generate_table_vector_vhd.cc](generate_table_vector_vhd.cc)

Generate [table_vector.vhd](table_vector.vhd) from [table_vector.txt](table_vector.txt)

### [add_scalar.vhd](add_scalar.vhd)

scalar saturating addition

### [add_vector.vhd](add_vector.vhd)

vector saturating addition

### [rol_vector.vhd](rol_vector.vhd)

rotate left vector elements

### [ror_vector.vhd](ror_vector.vhd)

rotate right vector elements

### [bnl_scalar.vhd](bnl_scalar.vhd)

scalar bit node links

### [bnl_vector.vhd](bnl_vector.vhd)

vector bit node links

### [cnt_vector.vhd](cnt_vector.vhd)

counts for the vector decoder

### [loc_vector.vhd](loc_vector.vhd)

locations for the vector decoder

### [var_scalar.vhd](var_scalar.vhd)

scalar variable nodes

### [var_vector.vhd](var_vector.vhd)

vector variable nodes

### [wdf_vector.vhd](wdf_vector.vhd)

write disable flags for the vector decoder

### [exclusive_reduce.hh](exclusive_reduce.hh)

Reduce N times while excluding ith input element

It computes the following, but having only O(N) complexity and using O(1) extra storage:

```
	output[0] = input[1];
	output[1] = input[0];
	for (int i = 2; i < N; ++i)
		output[i] = op(input[0], input[1]);
	for (int i = 0; i < N; ++i)
		for (int j = 2; j < N; ++j)
			if (i != j)
				output[i] = op(output[i], input[j]);
```

### [cnp_reference.hh](cnp_reference.hh)

Check node processor reference code

The C++ code below is also included in [cnp_reference.hh](cnp_reference.hh):

```
void cnp(int *output, const int *input, int cnt, int beta)
{
	int imags[cnt];
	for (int i = 0; i < cnt; ++i)
		imags[i] = min(max(abs(input[i]) - beta, 0), 31);

	int omags[cnt];
	CODE::exclusive_reduce(imags, omags, cnt, min);

	int isgns[cnt];
	for (int i = 0; i < cnt; ++i)
		isgns[i] = sgn(input[i]);

	int osgns[cnt];
	CODE::exclusive_reduce(isgns, osgns, cnt, mul);

	for (int i = 0; i < cnt; ++i)
		output[i] = osgns[i] * omags[i];
}
```

### [dec_reference.hh](dec_reference.hh)

IRA-LDPC decoder reference code

